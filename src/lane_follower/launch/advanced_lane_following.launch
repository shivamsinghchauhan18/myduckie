<launch>
  <!-- Advanced DuckieTown Lane Following System -->
  
  <!-- Parameters -->
  <param name="use_sim_time" value="false"/>
  
  <!-- Auto-detect robot name or use default -->
  <arg name="robot_name" default="blueduckie"/>
  
  <!-- Advanced Lane Detection Node -->
  <node name="advanced_lane_detector" pkg="lane_follower" type="advanced_lane_detector.py" output="screen">
    <param name="robot_name" value="$(arg robot_name)"/>
    <!-- Image processing parameters -->
    <param name="roi_top_ratio" value="0.6"/>
    <param name="roi_bottom_ratio" value="1.0"/>
    <!-- Color thresholds -->
    <param name="yellow_hue_low" value="15"/>
    <param name="yellow_hue_high" value="35"/>
    <param name="white_value_low" value="200"/>
    <!-- Edge detection parameters -->
    <param name="canny_low" value="50"/>
    <param name="canny_high" value="150"/>
    <!-- Hough line parameters -->
    <param name="hough_threshold" value="30"/>
    <param name="hough_min_line_len" value="20"/>
    <param name="hough_max_line_gap" value="300"/>
    <!-- Remap to robot-specific camera topic -->
    <remap from="/camera_node/image/compressed" to="/$(arg robot_name)/camera_node/image/compressed"/>
  </node>
  
  <!-- Enhanced Lane Controller Node -->
  <node name="enhanced_lane_controller" pkg="lane_follower" type="enhanced_lane_controller.py" output="screen">
    <!-- Speed parameters -->
    <param name="max_speed" value="0.3"/>
    <param name="min_speed" value="0.1"/>
    <param name="target_speed" value="0.25"/>
    <!-- Robot parameters -->
    <param name="wheel_distance" value="0.1"/>
    <!-- Lateral PID parameters -->
    <param name="kp_lateral" value="2.0"/>
    <param name="ki_lateral" value="0.1"/>
    <param name="kd_lateral" value="0.5"/>
    <!-- Heading PID parameters -->
    <param name="kp_heading" value="1.5"/>
    <param name="ki_heading" value="0.05"/>
    <param name="kd_heading" value="0.3"/>
    <!-- Advanced features -->
    <param name="adaptive_speed" value="true"/>
    <param name="curve_detection" value="true"/>
    <param name="predictive_control" value="true"/>
    <!-- Curve handling -->
    <param name="curve_threshold" value="0.3"/>
    <param name="curve_speed_factor" value="0.7"/>
    <!-- Safety parameters -->
    <param name="max_lateral_error" value="0.8"/>
    <param name="emergency_stop_threshold" value="1.0"/>
    <!-- Control smoothing -->
    <param name="smoothing_factor" value="0.8"/>
    <!-- Remap to robot-specific topics -->
    <remap from="/car_cmd_switch_node/cmd" to="/$(arg robot_name)/car_cmd_switch_node/cmd"/>
    <remap from="/wheels_driver_node/wheels_cmd" to="/$(arg robot_name)/wheels_driver_node/wheels_cmd"/>
  </node>
  
  <!-- Lane Obstacle Detector Node -->
  <node name="lane_obstacle_detector" pkg="lane_follower" type="lane_obstacle_detector.py" output="screen">
    <param name="detection_method" value="edge"/>
    <param name="min_obstacle_area" value="1000"/>
    <param name="safe_distance_pixels" value="60"/>
    <param name="obstacle_height_threshold" value="50"/>
  </node>
  
  <!-- Lane Performance Monitor -->
  <node name="lane_performance_monitor" pkg="lane_follower" type="lane_performance_monitor.py" output="screen">
    <param name="window_size" value="100"/>
    <param name="stats_interval" value="10.0"/>
  </node>
  
  <!-- Lane System Monitor -->
  <node name="lane_system_monitor" pkg="lane_follower" type="lane_system_monitor.py" output="screen">
    <param name="monitor_interval" value="2.0"/>
  </node>
  
</launch>