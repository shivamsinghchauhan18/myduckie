<launch>
  <!-- Ultra-Advanced DuckieTown Lane Following System - Standalone Version -->
  <!-- Core AI systems without external dependencies -->
  
  <!-- Parameters -->
  <param name="use_sim_time" value="false"/>
  
  <!-- Auto-detect robot name or use default -->
  <arg name="robot_name" default="blueduckie"/>
  <arg name="use_neural_detection" default="true"/>
  <arg name="use_mpc_control" default="true"/>
  <arg name="use_sensor_fusion" default="true"/>
  <arg name="use_adaptive_learning" default="true"/>
  
  <!-- Neural Network Lane Detection Node (with fallback) -->
  <node name="neural_lane_detector" pkg="lane_follower" type="neural_lane_detector.py" output="screen">
    <param name="robot_name" value="$(arg robot_name)"/>
    <!-- Remap to robot-specific camera topic -->
    <remap from="/camera_node/image/compressed" to="/$(arg robot_name)/camera_node/image/compressed"/>
  </node>
  
  <!-- Sensor Fusion System (simplified passthrough mode) -->
  <node name="sensor_fusion_system" pkg="lane_follower" type="sensor_fusion_system.py" output="screen">
    <!-- Remap sensor topics -->
    <remap from="/imu/data" to="/$(arg robot_name)/imu_node/data"/>
    <remap from="/odom" to="/$(arg robot_name)/kinematics_node/odometry"/>
  </node>
  
  <!-- Model Predictive Controller -->
  <node name="mpc_lane_controller" pkg="lane_follower" type="mpc_lane_controller.py" output="screen">
    <!-- MPC parameters -->
    <param name="mpc_horizon" value="5"/>  <!-- Reduced for stability -->
    <param name="mpc_dt" value="0.2"/>     <!-- Increased for stability -->
    <param name="target_speed" value="0.2"/> <!-- Reduced for safety -->
    <!-- Remap to robot-specific topics -->
    <remap from="/car_cmd_switch_node/cmd" to="/$(arg robot_name)/car_cmd_switch_node/cmd"/>
  </node>
  
  <!-- Adaptive Learning System (simplified) -->
  <node name="adaptive_learning_system" pkg="lane_follower" type="adaptive_learning_system.py" output="screen">
    <!-- Learning parameters -->
    <param name="learning_enabled" value="false"/>  <!-- Disabled initially for stability -->
    <param name="adaptation_interval" value="60.0"/>
  </node>
  
  <!-- Lane Obstacle Detector (Enhanced) -->
  <node name="lane_obstacle_detector" pkg="lane_follower" type="lane_obstacle_detector.py" output="screen">
    <param name="detection_method" value="combined"/>
    <param name="min_obstacle_area" value="800"/>
    <param name="safe_distance_pixels" value="80"/>
    <param name="obstacle_height_threshold" value="40"/>
    <!-- Enhanced parameters -->
    <param name="confidence_threshold" value="0.7"/>
    <param name="temporal_filtering" value="true"/>
    <param name="multi_scale_detection" value="true"/>
  </node>
  
  <!-- Advanced Performance Monitor -->
  <node name="lane_performance_monitor" pkg="lane_follower" type="lane_performance_monitor.py" output="screen">
    <param name="window_size" value="150"/>
    <param name="stats_interval" value="8.0"/>
    <param name="detailed_stats_interval" value="30.0"/>
    <!-- Enhanced metrics -->
    <param name="track_neural_performance" value="$(arg use_neural_detection)"/>
    <param name="track_mpc_performance" value="$(arg use_mpc_control)"/>
    <param name="track_fusion_performance" value="$(arg use_sensor_fusion)"/>
    <param name="track_learning_performance" value="$(arg use_adaptive_learning)"/>
  </node>
  
  <!-- Enhanced System Monitor -->
  <node name="lane_system_monitor" pkg="lane_follower" type="lane_system_monitor.py" output="screen">
    <param name="monitor_interval" value="1.5"/>
    <param name="health_check_interval" value="5.0"/>
    <!-- System integration monitoring -->
    <param name="monitor_neural_system" value="$(arg use_neural_detection)"/>
    <param name="monitor_mpc_system" value="$(arg use_mpc_control)"/>
    <param name="monitor_fusion_system" value="$(arg use_sensor_fusion)"/>
    <param name="monitor_learning_system" value="$(arg use_adaptive_learning)"/>
  </node>

</launch>